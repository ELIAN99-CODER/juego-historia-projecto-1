<script>
const KEYWORD = "SILEX";
const revealMap = {1: 1, 2: 2};
const QUESTIONS = [
  {id: 1, text: "¿De qué material estaban hechas las lanzas del paleolítico?", options: ["Hueso", "Piedra", "Madera"], correct: 1},
  {id: 2, text: "¿Qué tipo de hombre no se originó en África?", options: ["Neanderthal", "Homo habilis", "Australopithecus", "Homo erectus"], correct: 0}
];
let revealedIndices = [];
let answeredQuestions = new Set();

const wordpanel = document.getElementById("wordpanel");
const questionsList = document.getElementById("questionsList");
const modal = document.getElementById("modal");
const qtexto = document.getElementById("qtexto");
const opts = document.getElementById("opts");
const guessInput = document.getElementById("guessInput");
const submitGuessBtn = document.getElementById("submitGuess");
const statusLine = document.getElementById("statusLine");
const menuBtn = document.getElementById("menuBtn");
const closeModalBtn = document.getElementById("closeModal");

function renderWordPanel(){
  let html = "";
  for(let i=0;i<KEYWORD.length;i++){
    html += `<span>${revealedIndices.includes(i) ? KEYWORD[i] : "_"}</span>`;
  }
  wordpanel.innerHTML = html;
}

function buildMenu(){
  questionsList.innerHTML = "";
  QUESTIONS.forEach(q=>{
    if(!answeredQuestions.has(q.id)){ // ❗ Ocultar preguntas ya respondidas
      const btn = document.createElement("button");
      btn.textContent = `Pregunta ${q.id}`;
      btn.onclick = ()=>openQuestion(q.id);
      questionsList.appendChild(btn);
    }
  });

  // Si todas respondidas, desactivar menú
  if(answeredQuestions.size === QUESTIONS.length){
    menuBtn.disabled = true;
    questionsList.style.display = "none";
    guessInput.disabled = false;
  }
}

function openQuestion(id){
  const q = QUESTIONS.find(x=>x.id===id);
  if(!q) return;
  qtexto.textContent = `Pregunta ${q.id}: ${q.text}`;
  opts.innerHTML = "";
  q.options.forEach((opt, idx)=>{
    const b = document.createElement("button");
    b.className = "optbtn";
    b.textContent = opt;
    b.onclick = ()=>chooseOption(q.id, idx);
    opts.appendChild(b);
  });
  modal.style.display = "flex";
  questionsList.style.display = "none";
}

function closeModal(){
  modal.style.display = "none";
}

function chooseOption(qid, idx){
  const q = QUESTIONS.find(x=>x.id===qid);
  if(idx === q.correct){
    revealLetterForQuestion(qid);
    answeredQuestions.add(qid);
    markStatus("Correcto ✅", true);
    closeModal();
    buildMenu(); // ❗ Actualizar menú para quitar la pregunta respondida
  } else {
    markStatus("Incorrecto ❌", false);
  }
}

function revealLetterForQuestion(qid){
  const li = revealMap[qid];
  if(li !== undefined && !revealedIndices.includes(li)){
    revealedIndices.push(li);
  }
  renderWordPanel();
}

function markStatus(text, ok){
  statusLine.textContent = text;
  statusLine.className = ok ? "status correct" : "status incorrect";
}

function submitGuess(){
  if(answeredQuestions.size < QUESTIONS.length){
    markStatus("Debes responder todas las preguntas primero.", false);
    return;
  }
  const val = guessInput.value.trim();
  if(!val){
    markStatus("Escribe algo primero.", false);
    return;
  }
  if(val.toUpperCase() === KEYWORD){
    markStatus("CORRECTO ✅", true);
  } else {
    markStatus("INCORRECTO ❌", false);
  }
}

function toggleMenu(){
  questionsList.style.display = questionsList.style.display === "block" ? "none" : "block";
}

function init(){
  renderWordPanel();
  buildMenu();
  closeModalBtn.onclick = closeModal;
  submitGuessBtn.onclick = submitGuess;
  menuBtn.onclick = toggleMenu;
  modal.onclick = (e)=>{if(e.target===modal) closeModal();};
}

init();
</script>
